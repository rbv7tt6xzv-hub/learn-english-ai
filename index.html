<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>English Tutor AI ‚Äî Real Practice</title>
  <style>
    :root{
      --bg:#0b1220; --card:#101b33; --card2:#0f172a;
      --text:#e5e7eb; --muted:#94a3b8; --line:#22304f;
      --green:#22c55e; --blue:#60a5fa; --yellow:#fbbf24; --red:#ef4444;
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:linear-gradient(180deg,#070c16, #0b1220 35%, #070c16);
      color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Arial, sans-serif;
      min-height:100vh; display:flex; justify-content:center; padding:18px;
    }
    .app{width:100%; max-width:980px; display:grid; gap:14px; grid-template-columns: 1fr; }
    @media (min-width: 880px){ .app{grid-template-columns: 360px 1fr;} }

    .panel{
      background:rgba(16,27,51,.85); border:1px solid var(--line);
      border-radius:var(--radius); padding:14px;
      box-shadow: 0 12px 30px rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
    }
    .brand{display:flex; align-items:center; justify-content:space-between; gap:10px;}
    .brand h1{margin:0; font-size:18px; letter-spacing:.2px}
    .tag{font-size:12px; color:var(--muted); border:1px solid var(--line); padding:6px 10px; border-radius:999px; background:#0b1220;}
    .stats{margin-top:12px; display:grid; gap:10px;}
    .stat{
      background:var(--card2); border:1px solid var(--line); border-radius:14px; padding:12px;
      display:flex; justify-content:space-between; align-items:center;
    }
    .stat .k{color:var(--muted); font-size:12px}
    .stat .v{font-weight:800}
    .progress{
      margin-top:12px; background:var(--card2); border:1px solid var(--line); border-radius:14px; padding:12px;
    }
    .bar{height:10px; border-radius:999px; background:#0b1220; border:1px solid var(--line); overflow:hidden}
    .fill{height:100%; width:0%; background:var(--green)}
    .small{color:var(--muted); font-size:12px; line-height:1.35}

    /* Main */
    .header{display:flex; justify-content:space-between; align-items:flex-start; gap:10px; flex-wrap:wrap;}
    .header .title{margin:0; font-size:18px}
    .header .sub{margin:4px 0 0 0; color:var(--muted); font-size:13px; line-height:1.35}
    .tutors{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .tutorBtn{
      border:1px solid var(--line); background:#0b1220; color:var(--text);
      padding:10px 10px; border-radius:14px; cursor:pointer; min-width:170px;
      display:flex; justify-content:space-between; align-items:center; gap:8px;
    }
    .tutorBtn.active{border-color: rgba(34,197,94,.7); box-shadow: 0 0 0 3px rgba(34,197,94,.15);}
    .tutorName{font-weight:800; font-size:13px}
    .tutorRole{color:var(--muted); font-size:12px}
    .pill{font-size:11px; color:var(--muted); border:1px solid var(--line); padding:4px 8px; border-radius:999px}

    .lesson{
      margin-top:12px; background:var(--card2); border:1px solid var(--line); border-radius:var(--radius); padding:14px;
    }
    .scene{color:var(--muted); font-size:13px; line-height:1.35}
    .prompt{
      margin-top:10px; background:#0b1220; border:1px solid var(--line);
      border-radius:14px; padding:12px;
    }
    .label{color:var(--muted); font-size:12px; margin:0 0 6px}
    .es{margin:0; font-size:18px; font-weight:900}
    .en{margin:8px 0 0; font-size:16px; font-weight:800; color:#dbeafe}
    .hint{margin:8px 0 0; color:var(--muted); font-size:13px; line-height:1.35}
    .meaning{margin:8px 0 0; color:#cbd5e1; font-size:13px; line-height:1.35}

    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .btn{
      flex:1; min-width:170px;
      border:none; border-radius:14px; padding:12px 12px; font-weight:900; font-size:14px;
      cursor:pointer;
    }
    .btn.primary{background:var(--green); color:#05210f}
    .btn.secondary{background:#334155; color:#e2e8f0}
    .btn.warn{background:var(--yellow); color:#1f1300}
    .btn.danger{background:var(--red); color:white}
    input, textarea{
      width:100%; margin-top:10px; background:#0b1220; color:var(--text);
      border:1px solid var(--line); border-radius:14px; padding:12px; font-size:16px;
      outline:none;
    }
    .choices{display:grid; gap:10px; margin-top:10px}
    .choice{
      text-align:left; padding:12px; border-radius:14px; border:1px solid var(--line);
      background:#0b1220; color:var(--text); cursor:pointer; font-weight:800;
    }
    .choice.correct{border-color: rgba(34,197,94,.7)}
    .choice.wrong{border-color: rgba(239,68,68,.7)}
    .feedback{
      margin-top:12px; font-weight:900; line-height:1.35;
    }
    .feedback.ok{color:#86efac}
    .feedback.bad{color:#fca5a5}
    .divider{height:1px; background:var(--line); margin:12px 0}
  </style>
</head>
<body>
  <div class="app">
    <!-- Left panel -->
    <div class="panel">
      <div class="brand">
        <h1>English Tutor AI üá∫üá∏</h1>
        <span class="tag" id="modeTag">Survival</span>
      </div>
      <p class="small" style="margin:8px 0 0">
        Aprende ingl√©s real: escucha, traduce, responde y practica conversaci√≥n.
        <br/>Honesto: sin backend = no ‚ÄúchatGPT dentro‚Äù, pero s√≠ entrenamiento real.
      </p>

      <div class="stats">
        <div class="stat"><div><div class="k">XP</div><div class="v" id="xp">0</div></div><div class="pill" id="lvl">Nivel 1</div></div>
        <div class="stat"><div><div class="k">Racha</div><div class="v" id="streak">0</div></div><div class="pill">üî•</div></div>
        <div class="stat"><div><div class="k">Lecci√≥n</div><div class="v" id="step">1</div></div><div class="pill" id="unit">Unidad 1</div></div>
      </div>

      <div class="progress">
        <div class="small" id="progressText">Progreso: 0%</div>
        <div class="bar" style="margin-top:8px"><div class="fill" id="fill"></div></div>
      </div>

      <div class="divider"></div>

      <div class="small">
        ‚úÖ Voz ES/EN usando tu tel√©fono (SpeechSynthesis).<br/>
        üé§ Reconocimiento de voz depende del navegador (si no funciona, se usa escritura).<br/>
        Si no se oye: sube volumen y quita silencio.
      </div>

      <div class="actions" style="margin-top:12px">
        <button class="btn secondary" onclick="resetAll()">üîÅ Reiniciar</button>
        <button class="btn danger" onclick="stopVoice()">üîá Parar voz</button>
      </div>
    </div>

    <!-- Main panel -->
    <div class="panel">
      <div class="header">
        <div>
          <p class="title" id="lessonTitle">Cargando‚Ä¶</p>
          <p class="sub" id="lessonSub">‚Ä¶</p>
        </div>
        <div class="pill" id="exerciseTag">Exercise</div>
      </div>

      <div class="tutors">
        <button class="tutorBtn active" id="t0" onclick="setTutor(0)">
          <div>
            <div class="tutorName">üë©‚Äçüè´ Ana</div>
            <div class="tutorRole">Explica en espa√±ol</div>
          </div>
          <span class="pill">ES ‚Üí EN</span>
        </button>
        <button class="tutorBtn" id="t1" onclick="setTutor(1)">
          <div>
            <div class="tutorName">üë®‚Äçüè´ Mike</div>
            <div class="tutorRole">Pronunciaci√≥n</div>
          </div>
          <span class="pill">EN audio</span>
        </button>
        <button class="tutorBtn" id="t2" onclick="setTutor(2)">
          <div>
            <div class="tutorName">üßë‚Äçüè´ Alex</div>
            <div class="tutorRole">Conversaci√≥n</div>
          </div>
          <span class="pill">Chat guiado</span>
        </button>
      </div>

      <div class="lesson">
        <p class="scene" id="scene">‚Ä¶</p>

        <div class="prompt">
          <p class="label" id="labelES">Espa√±ol:</p>
          <p class="es" id="esText">‚Ä¶</p>

          <p class="label" id="labelEN" style="margin-top:12px">Ingl√©s (objetivo):</p>
          <p class="en" id="enText">‚Ä¶</p>

          <p class="meaning" id="meaning">‚Ä¶</p>
          <p class="hint" id="hint">‚Ä¶</p>
        </div>

        <div id="exerciseArea"></div>

        <div class="actions">
          <button class="btn warn" onclick="speakPrompt()">üîä Tutor pregunta (ES)</button>
          <button class="btn secondary" onclick="speakAnswer()">üîä Escuchar ingl√©s (EN)</button>
          <button class="btn secondary" onclick="showHelp()">üí° Ver pista</button>
        </div>

        <div class="actions">
          <button class="btn primary" onclick="check()">‚úÖ Revisar</button>
          <button class="btn secondary" onclick="next()">‚û°Ô∏è Siguiente</button>
        </div>

        <div class="feedback" id="fb"></div>
      </div>
    </div>
  </div>

<script>
  // --------- Data (real, honesto, √∫til) ----------
  const tutors = [
    { name:"Ana", esLang:"es-ES", enLang:"en-US", pitchES:1.05, rateES:0.97, pitchEN:1.10, rateEN:0.92 },
    { name:"Mike", esLang:"es-ES", enLang:"en-US", pitchES:0.95, rateES:0.95, pitchEN:0.92, rateEN:0.92 },
    { name:"Alex", esLang:"es-ES", enLang:"en-US", pitchES:1.00, rateES:0.98, pitchEN:1.02, rateEN:0.98 }
  ];

  const unit = {
    name: "Unidad 1 ‚Äî Supervivencia",
    lessons: [
      {
        title: "Conocer a alguien",
        scene: "Situaci√≥n: primera vez en EE.UU. alguien te pregunta de d√≥nde eres.",
        es: "¬øDe d√≥nde eres?",
        en: "Where are you from?",
        meaning: "Significa: ‚Äò¬øCu√°l es tu lugar de origen?‚Äô (pa√≠s/ciudad).",
        hint: "Pista: empieza con Where‚Ä¶ termina con from.",
        type: "TYPE_TRANSLATION"
      },
      {
        title: "Cafeter√≠a",
        scene: "Situaci√≥n: en una cafeter√≠a. Te preguntan qu√© quieres tomar.",
        es: "¬øQu√© te gustar√≠a tomar?",
        en: "What would you like to drink?",
        meaning: "Es una forma educada para pedir algo. Muy com√∫n.",
        hint: "Pista: la frase de cortes√≠a usa ‚Äòwould you like‚Äô.",
        type: "MULTIPLE_CHOICE",
        choices: [
          "What you like drink?",
          "What would you like to drink?",
          "Where would you drink?"
        ],
        answerIndex: 1
      },
      {
        title: "Tu nombre",
        scene: "Situaci√≥n: alguien quiere saber tu nombre.",
        es: "¬øC√≥mo te llamas?",
        en: "What's your name?",
        meaning: "What‚Äôs = What is. Muy b√°sico y natural.",
        hint: "Pista: contracci√≥n What‚Äôs + your + name?",
        type: "ORDER_WORDS",
        bank: ["your", "name?", "What's"]
      },
      {
        title: "Mini conversaci√≥n",
        scene: "Situaci√≥n: alguien dice ‚ÄòNice to meet you!‚Äô T√∫ respondes.",
        es: "Igualmente / Mucho gusto",
        en: "Nice to meet you too!",
        meaning: "‚Äòtoo‚Äô significa ‚Äòtambi√©n‚Äô. Respuesta natural.",
        hint: "Pista: la respuesta correcta incluye ‚Äòtoo‚Äô.",
        type: "GUIDED_CHAT",
        botEN: "Nice to meet you!",
        options: ["Nice meet you.", "Nice to meet you too!", "Where are you too?"],
        answerIndex: 1
      }
    ]
  };

  // --------- State ----------
  let tutorIndex = 0;
  let i = 0;
  let xp = 0;
  let streak = 0;
  let helpShown = false;

  // --------- Helpers ----------
  const $ = (id)=>document.getElementById(id);
  const norm = (s)=> (s||"").toLowerCase().trim().replace(/[‚Äô]/g,"'").replace(/\s+/g," ");

  function speak(text, lang, pitch=1.0, rate=1.0){
    const u = new SpeechSynthesisUtterance(text);
    u.lang = lang; u.pitch = pitch; u.rate = rate;
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  }
  function stopVoice(){ speechSynthesis.cancel(); }

  function setTutor(n){
    tutorIndex = n;
    ["t0","t1","t2"].forEach((id,idx)=>$(id).classList.toggle("active", idx===n));
    render();
  }

  function updateStats(){
    $("xp").innerText = xp;
    $("streak").innerText = streak;
    const lvl = 1 + Math.floor(xp/40);
    $("lvl").innerText = `Nivel ${lvl}`;

    $("step").innerText = (i+1);
    $("unit").innerText = unit.name;

    const pct = Math.round(((i) / unit.lessons.length) * 100);
    $("progressText").innerText = `Progreso: ${pct}%`;
    $("fill").style.width = pct + "%";
  }

  function exerciseLabel(type){
    if(type==="TYPE_TRANSLATION") return "Traducci√≥n (ES‚ÜíEN)";
    if(type==="MULTIPLE_CHOICE") return "Opci√≥n m√∫ltiple";
    if(type==="ORDER_WORDS") return "Ordena palabras";
    if(type==="GUIDED_CHAT") return "Conversaci√≥n guiada";
    return "Ejercicio";
  }

  function render(){
    helpShown = false;
    $("fb").className = "feedback";
    $("fb").innerText = "";

    const L = unit.lessons[i];
    $("lessonTitle").innerText = `${L.title}`;
    $("lessonSub").innerText = `Tutor: ${tutors[tutorIndex].name} ¬∑ ${unit.name}`;
    $("exerciseTag").innerText = exerciseLabel(L.type);

    $("scene").innerText = L.scene;
    $("esText").innerText = L.es;

    // En apps reales NO se muestra siempre la respuesta.
    // Aqu√≠ se muestra ‚Äúobjetivo‚Äù como referencia (tipo Duolingo: puedes ocultarlo si quieres).
    $("enText").innerText = (tutorIndex===1) ? "Escucha primero y escribe." : "Objetivo: " + L.en;

    $("meaning").innerText = "üìå " + L.meaning;
    $("hint").innerText = helpShown ? ("üí° " + L.hint) : "üí° Pista oculta (toca ‚ÄúVer pista‚Äù).";

    renderExercise(L);
    updateStats();
  }

  function renderExercise(L){
    const area = $("exerciseArea");
    area.innerHTML = "";

    if(L.type==="TYPE_TRANSLATION"){
      const inp = document.createElement("input");
      inp.id = "answer";
      inp.placeholder = "Escribe en ingl√©s (sin ver ayuda)‚Ä¶";
      area.appendChild(inp);
      return;
    }

    if(L.type==="MULTIPLE_CHOICE"){
      const wrap = document.createElement("div");
      wrap.className = "choices";
      wrap.dataset.selected = "";

      L.choices.forEach((c, idx)=>{
        const btn = document.createElement("button");
        btn.className = "choice";
        btn.type = "button";
        btn.innerText = c;
        btn.onclick = ()=>{
          wrap.dataset.selected = String(idx);
          // Reset styles
          [...wrap.querySelectorAll(".choice")].forEach(x=>x.classList.remove("correct","wrong"));
        };
        wrap.appendChild(btn);
      });

      area.appendChild(wrap);
      return;
    }

    if(L.type==="ORDER_WORDS"){
      const p = document.createElement("p");
      p.className = "small";
      p.innerText = "Toca palabras en orden para formar la frase:";
      area.appendChild(p);

      const bank = document.createElement("div");
      bank.className = "choices";
      bank.style.gridTemplateColumns = "1fr";

      const built = document.createElement("div");
      built.id = "built";
      built.className = "prompt";
      built.style.marginTop = "10px";
      built.innerHTML = `<p class="label">Tu frase:</p><p class="en" id="builtText"></p>`;
      area.appendChild(bank);
      area.appendChild(built);

      const chosen = [];
      L.bank.forEach(tok=>{
        const b = document.createElement("button");
        b.className = "choice";
        b.type = "button";
        b.innerText = tok;
        b.onclick = ()=>{
          chosen.push(tok);
          $("builtText").innerText = chosen.join(" ");
          b.disabled = true;
          b.style.opacity = .55;
        };
        bank.appendChild(b);
      });

      const reset = document.createElement("button");
      reset.className = "btn secondary";
      reset.style.marginTop = "10px";
      reset.innerText = "‚Ü©Ô∏è Rehacer";
      reset.onclick = ()=>render();
      area.appendChild(reset);
      return;
    }

    if(L.type==="GUIDED_CHAT"){
      const box = document.createElement("div");
      box.className = "prompt";
      box.innerHTML = `<p class="label">√âl/Ella dice:</p><p class="en">"${L.botEN}"</p><p class="label" style="margin-top:10px">T√∫ respondes:</p>`;
      area.appendChild(box);

      const wrap = document.createElement("div");
      wrap.className = "choices";
      wrap.dataset.selected = "";
      L.options.forEach((c, idx)=>{
        const btn = document.createElement("button");
        btn.className = "choice";
        btn.type = "button";
        btn.innerText = c;
        btn.onclick = ()=>{
          wrap.dataset.selected = String(idx);
          [...wrap.querySelectorAll(".choice")].forEach(x=>x.classList.remove("correct","wrong"));
        };
        wrap.appendChild(btn);
      });
      area.appendChild(wrap);
      return;
    }
  }

  function speakPrompt(){
    const L = unit.lessons[i];
    const T = tutors[tutorIndex];
    const question = `¬øC√≥mo se dice "${L.es}" en ingl√©s?`;
    speak(question, T.esLang, T.pitchES, T.rateES);
  }

  function speakAnswer(){
    const L = unit.lessons[i];
    const T = tutors[tutorIndex];
    speak(L.en, T.enLang, T.pitchEN, T.rateEN);
  }

  function showHelp(){
    helpShown = true;
    const L = unit.lessons[i];
    $("hint").innerText = "üí° " + L.hint;
    speak("Pista. " + L.hint, tutors[tutorIndex].esLang, tutors[tutorIndex].pitchES, tutors[tutorIndex].rateES);
  }

  function win(msg){
    const gain = helpShown ? 8 : 12;
    xp += gain;
    streak += 1;
    $("fb").className = "feedback ok";
    $("fb").innerText = `‚úÖ ${msg} (+${gain} XP)`;
    speak("Correcto. Muy bien.", tutors[tutorIndex].esLang, tutors[tutorIndex].pitchES, tutors[tutorIndex].rateES);
    updateStats();
  }

  function lose(msg){
    streak = 0;
    $("fb").className = "feedback bad";
    $("fb").innerText = `‚ùå ${msg}`;
    speak("No. Int√©ntalo otra vez.", tutors[tutorIndex].esLang, tutors[tutorIndex].pitchES, tutors[tutorIndex].rateES);
    updateStats();
  }

  function check(){
    const L = unit.lessons[i];

    if(L.type==="TYPE_TRANSLATION"){
      const val = norm(($("answer")||{}).value);
      if(!val) return lose("Escribe tu respuesta en ingl√©s.");
      if(val === norm(L.en)) return win("Traducci√≥n perfecta.");
      return lose("No coincide. Escucha el ingl√©s y prueba de nuevo.");
    }

    if(L.type==="MULTIPLE_CHOICE"){
      const wrap = $("exerciseArea").querySelector(".choices");
      const sel = wrap?.dataset.selected ?? "";
      if(sel==="") return lose("Elige una opci√≥n.");
      const ok = Number(sel) === L.answerIndex;
      const btns = [...wrap.querySelectorAll(".choice")];
      btns.forEach((b, idx)=>{
        if(idx === L.answerIndex) b.classList.add("correct");
        if(idx === Number(sel) && !ok) b.classList.add("wrong");
      });
      return ok ? win("Excelente elecci√≥n.") : lose("Esa no suena natural en ingl√©s.");
    }

    if(L.type==="ORDER_WORDS"){
      const built = (document.getElementById("builtText")?.innerText)||"";
      if(!built.trim()) return lose("Forma la frase tocando las palabras.");
      if(norm(built) === norm(L.en)) return win("Orden correcto.");
      return lose("El orden est√° mal. Rehaz y prueba.");
    }

    if(L.type==="GUIDED_CHAT"){
      const wrap = $("exerciseArea").querySelector(".choices");
      const sel = wrap?.dataset.selected ?? "";
      if(sel==="") return lose("Elige una respuesta.");
      const ok = Number(sel) === L.answerIndex;
      const btns = [...wrap.querySelectorAll(".choice")];
      btns.forEach((b, idx)=>{
        if(idx === L.answerIndex) b.classList.add("correct");
        if(idx === Number(sel) && !ok) b.classList.add("wrong");
      });
      return ok ? win("Respuesta natural.") : lose("Eso suena raro en ingl√©s. Elige la natural.");
    }
  }

  function next(){
    stopVoice();
    helpShown = false;
    $("hint").innerText = "üí° Pista oculta (toca ‚ÄúVer pista‚Äù).";
    $("fb").className = "feedback";
    $("fb").innerText = "";

    if(i < unit.lessons.length - 1){
      i++;
      render();
    } else {
      $("lessonTitle").innerText = "üéâ Unidad completada";
      $("lessonSub").innerText = "Esto ya es una base tipo Duolingo (sin backend).";
      $("exerciseTag").innerText = "Finish";
      $("scene").innerText = "Siguiente paso real: agregar 50+ lecciones, audio por palabra y un modo conversaci√≥n con API.";
      $("esText").innerText = "¬øListo para la Unidad 2?";
      $("enText").innerText = "You‚Äôre ready for Unit 2.";
      $("meaning").innerText = "üìå Si quieres IA conversacional real (como tutor), ah√≠ s√≠ se integra API + backend. Sin mentiras.";
      $("hint").innerText = "üí° Dime y te doy la arquitectura m√≠nima y segura.";
      $("exerciseArea").innerHTML = "";
      updateStats();
    }
  }

  function resetAll(){
    stopVoice();
    tutorIndex = 0; i = 0; xp = 0; streak = 0; helpShown = false;
    ["t0","t1","t2"].forEach((id,idx)=>$(id).classList.toggle("active", idx===0));
    render();
  }

  // Init
  render();
</script>
</body>
</html>
